(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/AddLoss/AddLoss"],{496:function(e,t,s){"use strict";(function(e,t){var a=s(4);s(26);a(s(25));var n=a(s(497));e.__webpack_require_UNI_MP_PLUGIN__=s,t(n.default)}).call(this,s(1)["default"],s(2)["createPage"])},497:function(e,t,s){"use strict";s.r(t);var a=s(498),n=s(500);for(var i in n)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return n[e]}))}(i);s(502);var r,o=s(36),u=Object(o["default"])(n["default"],a["render"],a["staticRenderFns"],!1,null,"2632b8e0",null,!1,a["components"],r);u.options.__file="pages/AddLoss/AddLoss.vue",t["default"]=u.exports},498:function(e,t,s){"use strict";s.r(t);var a=s(499);s.d(t,"render",(function(){return a["render"]})),s.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),s.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),s.d(t,"components",(function(){return a["components"]}))},499:function(e,t,s){"use strict";var a;s.r(t),s.d(t,"render",(function(){return n})),s.d(t,"staticRenderFns",(function(){return r})),s.d(t,"recyclableRender",(function(){return i})),s.d(t,"components",(function(){return a}));try{a={uniForms:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(s.bind(null,1116))},uniFormsItem:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(s.bind(null,1129))},uniPopup:function(){return s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(s.bind(null,1075))}}}catch(o){if(-1===o.message.indexOf("Cannot find module")||-1===o.message.indexOf(".vue"))throw o;console.error(o.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var n=function(){var e=this,t=e.$createElement,s=(e._self._c,e.params.detailList.length),a=e.__map(e.params.detailList,(function(t,s){var a=e.__get_orig(t),n=e._f("decimalFormat")(e.num(s));return{$orig:a,f0:n}})),n=e.productList&&e.productList.length>0;e.$mp.data=Object.assign({},{$root:{g0:s,l0:a,g1:n}})},i=!1,r=[];n._withStripped=!0},500:function(e,t,s){"use strict";s.r(t);var a=s(501),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t["default"]=n.a},501:function(e,t,s){"use strict";(function(e){var a=s(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var n=a(s(53)),i=a(s(55)),r=s(57),o=(s(473),s(25),function(){s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(function(){return resolve(s(1075))}.bind(null,s)).catch(s.oe)}),u={components:{uniPopup:o},data:function(){return{indicatorStyle:"height: 50px;",store:"",outWarehouseDelId:"",outWarehouseName:"",inWarehouseName:"",orderType:"",paymentTerms:"",agentUser:"",value:[0],selectList:[],selectList1:[],selectIndex:0,openIndex:null,product:[{},{}],productList:[],searchValue:"",params:{pageNum:1,pageSize:20,detailList:[{}]},index:"",params1:{pageNum:1,pageSize:20},params2:{pageNum:1,pageSize:20},params3:{pageNum:1,pageSize:20},item:{},array:["移库","调拨"],selectList2:[],inventoryId:"",warehouseId:"",customerAddress:"",classification:"",title:"",aa:!1,Number:0,rules:{quantity:{rules:[{required:!0,errorMessage:"请输入正确数量"},{pattern:/^[1-9]\d*$/,errorMessage:"请输入大于零的整数"}]},positionCode:{rules:[{required:!0,errorMessage:'请输入库位"'}]},price:{rules:[{required:!0,errorMessage:'请输入单价"'}]}},showMask:!1,salesmanList:[],choiceSalesman:{}}},computed:{num:function(e){return function(e){return void 0!=this.params.detailList[e].price&&void 0!=this.params.detailList[e].quantity?(this.params.detailList[e].num=this.params.detailList[e].quantity*this.params.detailList[e].price,this.params.detailList[e].num,this.params.detailList[e].num):this.params.detailList[e].num=0}}},onLoad:function(){var e=this;return(0,i.default)(n.default.mark((function t(){var s;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,(0,r.getwarehouse)(e.params3);case 2:s=t.sent,s.data.items&&(e.outWarehouseName=s.data.items[0].warehouseName,e.params.storeName=e.outWarehouseName,e.params.storeId=s.data.items[0].warehouseId,e.params1.warehouseId=s.data.items[0].warehouseId,e.warehouseId=s.data.items[0].warehouseId);case 4:case"end":return t.stop()}}),t)})))()},onBackPress:function(e){if("navigateBack"==e.from){var t=getCurrentPages(),s=t[t.length-2];s=s.$vm,s&&s.getList&&(null==s.list?s.getList(1,1):s.getList(1,s.list.length+1))}},filters:{decimalFormat:function(e){return e.toFixed(2)}},methods:{open:function(t){var s=this;return(0,i.default)(n.default.mark((function a(){var i,o,u;return n.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s.selectIndex=0,s.selectList=[],s.selectList1=[],s.selectList2=[],a.t0=t,a.next=0===a.t0?7:3===a.t0?13:4===a.t0?19:25;break;case 7:return s.title="请选择门店",a.next=10,(0,r.getwarehouse)(s.params3);case 10:return i=a.sent,i.data.items?i.data.items.forEach((function(e){s.selectList.push(e.warehouseName),s.selectList1.push(e.warehouseId),s.selectList2.push(e.warehouseCode)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",25);case 13:return s.title="请选择责任单位",a.next=16,(0,r.getcustomer)(s.params3);case 16:return o=a.sent,o.data.items?o.data.items.forEach((function(e){s.selectList.push(e.customerAddress),s.selectList1.push(e.customerId)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",25);case 19:return s.title="请选择分类",a.next=22,(0,r.getclassification)(s.params3);case 22:return u=a.sent,u.data?u.data.forEach((function(e){s.selectList.push(e.dictLabel)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",25);case 25:s.$refs.popup.open(),s.openIndex=t;case 27:case"end":return a.stop()}}),a)})))()},bindTextAreaBlur:function(e){this.params.remark=e.detail.value},scrolltolowerFun:function(){var e=this;return(0,i.default)(n.default.mark((function t(){var s;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.params2.pageNum=e.params2.pageNum+1,t.next=3,(0,r.getinventory)(e.params2);case 3:if(s=t.sent,null==s.data.items){t.next=8;break}s.data.items.forEach((function(t){e.productList.push(t)})),t.next=10;break;case 8:return e.aa=!0,t.abrupt("return");case 10:case"end":return t.stop()}}),t)})))()},add:function(){this.params.detailList.push({}),this.Number++},del:function(e){if(this.params.detailList.length>1){var t=this.params.detailList.filter((function(t,s){return s!==e}));this.params.detailList=t}this.Number>0&&this.Number--},cancel:function(){this.$refs.popup.close()},success:function(){switch(this.openIndex){case 0:this.outWarehouseName=this.selectList[this.selectIndex],this.params.storeName!=this.outWarehouseName&&this.clear(),this.params.storeName=this.outWarehouseName,this.params.warehouseId=this.selectList1[this.selectIndex],this.params.storeId=this.selectList1[this.selectIndex],this.params1.warehouseId=this.selectList1[this.selectIndex],this.warehouseId=this.selectList1[this.selectIndex];break;case 3:this.customerAddress=this.selectList[this.selectIndex],this.params.customer=this.customerAddress,this.params.customerId=this.selectList1[this.selectIndex];break;case 4:this.classification=this.selectList[this.selectIndex],this.params2.classify=this.classification;break}this.$refs.popup.close()},clear:function(){this.params.detailList=[{quantity:"",positionCode:"",price:""}]},Return:function(){var t=this;return(0,i.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:for(t.params.status=1,a=0;a<=t.Number;a++)t.$refs.form[a].validate().then(function(){var s=(0,i.default)(n.default.mark((function s(a){var i;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,(0,r.adddamage)(t.params);case 2:i=s.sent,200==i.code&&(e.showToast({title:"新增成功",icon:"none",duration:1e3}),setTimeout((function(){e.navigateBack({data:1})}),1e3));case 4:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}());case 2:case"end":return s.stop()}}),s)})))()},search1:function(){var t=this;return(0,i.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.productList=[],s.next=3,(0,r.getinventory)(t.params2);case 3:if(a=s.sent,null==a.data.items){s.next=8;break}t.productList=a.data.items,s.next=10;break;case 8:return e.showToast({title:"没有数据",icon:"none",duration:1e3}),s.abrupt("return");case 10:case"end":return s.stop()}}),s)})))()},Return1:function(){var t=this;return(0,i.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:for(t.params.status=0,a=0;a<=t.Number;a++)t.$refs.form[a].validate().then(function(){var s=(0,i.default)(n.default.mark((function s(a){var i;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,(0,r.adddamage)(t.params);case 2:i=s.sent,200==i.code&&(e.showToast({title:"暂存成功",icon:"none",duration:1e3}),setTimeout((function(){e.navigateBack({data:1})}),1e3));case 4:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}());case 2:case"end":return s.stop()}}),s)})))()},bindChange:function(e){this.selectIndex=e.detail.value[0]},reset:function(){var e=this;return(0,i.default)(n.default.mark((function t(){var s,a;return n.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.classification="",e.productList=[],s={pageNum:1,pageSize:20},s.warehouseId=e.params2.warehouseId,e.params2={pageNum:1,pageSize:20,warehouseId:s.warehouseId,carg:"",productName:"",pinyin:""},t.next=7,(0,r.getinventory)(s);case 7:a=t.sent,null!=a.data.items&&(e.productList=a.data.items),e.aa=!1;case 10:case"end":return t.stop()}}),t)})))()},openProduct:function(e){var t=this;return(0,i.default)(n.default.mark((function s(){var a;return n.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.inventoryId="",t.index=e,t.params2.pageNum=1,t.params2.pageSize=20,t.params2.warehouseId=t.params1.warehouseId,s.next=7,(0,r.getinventory)(t.params2);case 7:a=s.sent,null!=a.data.items&&(t.productList=a.data.items),t.$refs.product.open();case 10:case"end":return s.stop()}}),s)})))()},closeProduct:function(){this.$refs.product.close()},choice:function(e){this.inventoryId=e.inventoryId,this.item=e},join:function(){if(""==this.inventoryId)return e.showToast({title:"请选择产品",icon:"none",duration:1e3});for(var t=0;t<this.params.detailList.length;t++)if(this.params.detailList[t].inventoryId==this.item.inventoryId)return e.showToast({title:"不能添加相同的产品",icon:"none",duration:1e3});this.$set(this.params.detailList[this.index],"inventoryId",this.item.inventoryId),this.$set(this.params.detailList[this.index],"positionCode",this.item.positionCode),this.$set(this.params.detailList[this.index],"productName",this.item.productName),this.$set(this.params.detailList[this.index],"productId",this.item.productId),this.$set(this.params.detailList[this.index],"quantity",this.item.usableQuantity),this.$set(this.params.detailList[this.index],"price",this.item.price),this.$refs.product.close()},chioceView:function(){var t=this,s=e.getSystemInfoSync().platform;"android"==s?(plus.android.checkPermission("android.permission.CAMERA",(function(e){-1==e.checkResult&&(t.showMask=!0)}),(function(e){console.error("Error checking permission:",e.message)})),plus.android.requestPermissions(["android.permission.CAMERA"],(function(e){t.showMask=!1,e.granted.length>0&&t.scanCarg()}))):this.scanCarg()},scanCarg:function(){var t=this;e.scanCode({onlyFromCamera:!0,scanType:["barCode"],success:function(s){var a={carg:s.result,pageNum:1,pageSize:1,warehouseId:t.params1.warehouseId};(0,r.getinventory)(a).then((function(s){if(200==s.code)if(s.data.items&&s.data.items.length>0){for(var a=0;a<t.params.detailList.length;a++)if(t.params.detailList[a].productId==s.data.items[0].productId)return e.showToast({title:"不能添加相同的产品",icon:"none",duration:1e3});var n=!0;for(a=0;a<t.params.detailList.length;a++)if(!t.params.detailList[a].productName){t.$set(t.params.detailList[a],"productName",s.data.items[0].productName),t.$set(t.params.detailList[a],"productId",s.data.items[0].productId),t.$set(t.params.detailList[a],"quantity",s.data.items[0].usableQuantity),t.$set(t.params.detailList[a],"inventoryId",s.data.items[0].inventoryId),t.$set(t.params.detailList[a],"positionCode",s.data.items[0].positionCode),t.$set(t.params.detailList[a],"price",s.data.items[0].price),n=!1;break}if(n){var i={productName:s.data.items[0].productName,productId:s.data.items[0].productId,quantity:s.data.items[0].usableQuantity,inventoryId:s.data.items[0].inventoryId,position:s.data.items[0].positionCode,price:s.data.items[0].price};t.params.detailList.push(i)}e.showToast({title:"扫描添加成功",icon:"none",duration:2e3})}else e.showToast({title:"该产品不存在",icon:"none",duration:2e3});else e.showToast({title:s.message,icon:"none",duration:2e3})}))}})},openSalesman:function(){var e=this,t={pageNum:1,pageSize:1e3};(0,r.getwen)(t).then((function(t){e.salesmanList=t.rows,e.$refs.salesman.open()}))},closesalesman:function(){this.$refs.salesman.close()},salesmanchoice:function(e){var t=this;this.salesmanList.forEach((function(s,a){s.userId==e.userId?(t.$set(t.salesmanList[a],"choice",!0),t.choiceSalesman=s):t.$set(t.salesmanList[a],"choice",!1)}))},submitSalesman:function(){this.agentUser=this.choiceSalesman.userName,this.params.constructionWork=this.choiceSalesman.userName,this.params.constructionWorkId=this.choiceSalesman.userId,this.$refs.salesman.close()}}};t.default=u}).call(this,s(2)["default"])},502:function(e,t,s){"use strict";s.r(t);var a=s(503),n=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t["default"]=n.a},503:function(e,t,s){}},[[496,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/AddLoss/AddLoss.js.map