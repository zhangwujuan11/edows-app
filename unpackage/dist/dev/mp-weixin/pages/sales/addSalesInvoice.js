(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sales/addSalesInvoice"],{816:function(t,e,s){"use strict";(function(t,e){var i=s(4);s(26);i(s(25));var a=i(s(817));t.__webpack_require_UNI_MP_PLUGIN__=s,e(a.default)}).call(this,s(1)["default"],s(2)["createPage"])},817:function(t,e,s){"use strict";s.r(e);var i=s(818),a=s(820);for(var o in a)["default"].indexOf(o)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(o);s(822);var n,r=s(36),c=Object(r["default"])(a["default"],i["render"],i["staticRenderFns"],!1,null,"5c98d296",null,!1,i["components"],n);c.options.__file="pages/sales/addSalesInvoice.vue",e["default"]=c.exports},818:function(t,e,s){"use strict";s.r(e);var i=s(819);s.d(e,"render",(function(){return i["render"]})),s.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),s.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),s.d(e,"components",(function(){return i["components"]}))},819:function(t,e,s){"use strict";var i;s.r(e),s.d(e,"render",(function(){return a})),s.d(e,"staticRenderFns",(function(){return n})),s.d(e,"recyclableRender",(function(){return o})),s.d(e,"components",(function(){return i}));try{i={uniPopup:function(){return s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(s.bind(null,1075))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var t=this,e=t.$createElement,s=(t._self._c,t.product.length),i=t.__map(t.product,(function(e,s){var i=t.__get_orig(e),a=e.price&&e.quantity?Math.floor(Number(e.price)*Number(e.quantity)*100):null;return{$orig:i,g1:a}})),a=t.productList&&t.productList.length>0;t.$mp.data=Object.assign({},{$root:{g0:s,l0:i,g2:a}})},o=!1,n=[];a._withStripped=!0},820:function(t,e,s){"use strict";s.r(e);var i=s(821),a=s.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},821:function(t,e,s){"use strict";(function(t){var i=s(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(s(18)),o=s(58),n=function(){s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(function(){return resolve(s(1075))}.bind(null,s)).catch(s.oe)},r={components:{uniPopup:n},data:function(){return{indicatorStyle:"height: 50px;",store:"",supplier:"",value:[0],selectIndex:0,openIndex:null,product:[{}],productList:[],carg:"",productVal:"",pinyinVal:"",classifyIndex:0,classifySelectList:["全部"],classifyList:["全部"],outWarehouseId:"",paramsList:[{name:"业务门店",value:"",list:[],select:{}},{name:"往来客户",value:"",list:[],select:{}},{name:"票据类型",value:"",list:[{label:"普通发票",value:0},{label:"其他",value:1},{label:"指定物流",value:2},{label:"其他备注",value:3}],select:{}},{name:"包装方式",value:"",list:[],select:{}},{name:"配送方式",value:"",list:[],select:{}},{name:"结算方式",value:"",list:[],select:{}},{name:"价格方式",value:"",list:[],select:{}}],submitParams:{},selectList:[],selectTitle:"",productPageNum:1,productPageSize:10,productTotal:0,productIndex:0,is_show:!1,is_conversion:!0,showMask:!1,salesmanList:[],choiceSalesman:{},constructionWork:"",constructionWorkId:""}},onBackPress:function(t){if("navigateBack"==t.from){var e=getCurrentPages(),s=e[e.length-2];s=s.$vm,s&&s.getList&&(null==s.list?s.getList(1,1):s.getList(1,s.list.length+1))}},onLoad:function(e){var s=this;e.outWarehouseId&&(this.outWarehouseId=e.outWarehouseId,t.setNavigationBarTitle({title:"修改入库单"})),Promise.all([this.getWarehouseList(),this.getCustomManagementList(),this.getStoreUserlist(),this.getPackagingMethod(),this.getDeliveryMethod(),this.getPaymentTerms(),this.getPriceMode()]).then((function(){e.outWarehouseId?s.getDetails():(s.paramsList[0].value=s.paramsList[0].list[s.selectIndex].warehouseName,s.paramsList[0].select=s.paramsList[0].list[s.selectIndex],s.productList=[],s.product=[{}],s.getProductList())})),this.getClassifyList()},methods:{open:function(t){switch(this.$refs.popup.open(),this.openIndex=t,this.selectTitle=this.paramsList[t].name,this.selectIndex=0,t){case 0:this.selectList=this.paramsList[t].list.map((function(t){return t.warehouseName}));break;case 1:this.selectList=this.paramsList[t].list.map((function(t){return t.name}));break;case 2:this.selectList=this.paramsList[t].list.map((function(t){return t.label}));break;case 3:this.selectList=this.paramsList[t].list.map((function(t){return t.dictLabel}));break;case 4:this.selectList=this.paramsList[t].list.map((function(t){return t.dictLabel}));break;case 5:this.selectList=this.paramsList[t].list.map((function(t){return t.dictLabel}));break;case 6:this.selectList=this.paramsList[t].list.map((function(t){return t.dictLabel}));break}},cancel:function(){this.$refs.popup.close()},success:function(){switch(this.openIndex){case 0:this.paramsList[0].value=this.paramsList[0].list[this.selectIndex].warehouseName,this.paramsList[0].select=this.paramsList[0].list[this.selectIndex],this.productList=[],this.productPageNum=1,this.productPageSize=10,this.getProductList(),this.cleanUp();break;case 1:this.paramsList[1].value=this.paramsList[1].list[this.selectIndex].name,this.paramsList[1].select=this.paramsList[1].list[this.selectIndex];break;case 2:this.paramsList[2].value=this.paramsList[2].list[this.selectIndex].label,this.paramsList[2].select=this.paramsList[2].list[this.selectIndex];break;case 3:this.paramsList[3].value=this.paramsList[3].list[this.selectIndex].dictLabel,this.paramsList[3].select=this.paramsList[3].list[this.selectIndex];break;case 4:this.paramsList[4].value=this.paramsList[4].list[this.selectIndex].dictLabel,this.paramsList[4].select=this.paramsList[4].list[this.selectIndex];break;case 5:this.paramsList[5].value=this.paramsList[5].list[this.selectIndex].dictLabel,this.paramsList[5].select=this.paramsList[5].list[this.selectIndex];break;case 6:this.paramsList[6].value=this.paramsList[6].list[this.selectIndex].dictLabel,this.paramsList[6].select=this.paramsList[6].list[this.selectIndex];break}this.$refs.popup.close()},bindChange:function(t){this.selectIndex=t.detail.value[0]},openProduct:function(t,e){this.operate=t,this.productIndex=e,this.chioceProduct(0),this.$refs.product.open(),this.choiceProduct={}},closeProduct:function(){this.$refs.product.close()},choice:function(t){var e=this;this.productList.forEach((function(s,i){s.productId==t.productId?(e.$set(e.productList[i],"choice",!0),e.choiceProduct=s):e.$set(e.productList[i],"choice",!1)}))},goChange:function(){t.navigateTo({url:"/pages/sales/conversionSales"})},getWarehouseList:function(){var t=this;return new Promise((function(e,s){(0,o.warehouseList)().then((function(s){200==s.code&&(t.paramsList[0].list=s.data.items,e(s))}))}))},getCustomManagementList:function(){var t=this;return new Promise((function(e,s){(0,o.customManagementList)().then((function(s){200==s.code&&(t.paramsList[1].list=s.data.items,e(s))}))}))},getStoreUserlist:function(){var t=this;return new Promise((function(e,s){(0,o.storeUserlist)({pageNum:1,pageSize:1500}).then((function(s){200==s.code&&(t.salesmanList=s.rows,e(s))}))}))},getPackagingMethod:function(){var t=this;return new Promise((function(e,s){(0,o.dictData)("packagingMethod").then((function(s){200==s.code&&(t.paramsList[3].list=s.data,e(s))}))}))},getDeliveryMethod:function(){var t=this;return new Promise((function(e,s){(0,o.dictData)("delivery_method").then((function(s){200==s.code&&(t.paramsList[4].list=s.data,e(s))}))}))},getPaymentTerms:function(){var t=this;return new Promise((function(e,s){(0,o.paymentTerms)().then((function(s){200==s.code&&(t.paramsList[5].list=s.data,e(s))}))}))},getPriceMode:function(){var t=this;return new Promise((function(e,s){(0,o.dictData)("priceMode").then((function(s){200==s.code&&(t.paramsList[6].list=s.data,e(s))}))}))},getDetails:function(e){var s=this;t.showLoading({title:"加载中"}),(0,o.outWarehouseSalesDetails)(this.outWarehouseId).then((function(i){if(t.hideLoading(),200==i.code){if(e&&(i.data.type=e),s.submitParams=i.data,s.product=i.data.detailList,i.data.storeId)for(var a=0;a<s.paramsList[0].list.length;a++)if(s.paramsList[0].list[a].warehouseId==i.data.storeId){s.paramsList[0].value=i.data.storeName,s.paramsList[0].select=s.paramsList[0].list[a];break}if(i.data.customerId)for(a=0;a<s.paramsList[1].list.length;a++)if(s.paramsList[1].list[a].customerId==i.data.customerId){s.paramsList[1].value=i.data.customer,s.paramsList[1].select=s.paramsList[1].list[a];break}if(i.data.constructionWorkId&&(s.constructionWorkId=i.data.constructionWorkId,s.constructionWork=i.data.constructionWork),i.data.billType)for(a=0;a<s.paramsList[2].list.length;a++)if(s.paramsList[2].list[a].value==i.data.billType){s.paramsList[2].value=s.paramsList[2].list[a].label,s.paramsList[2].select=s.paramsList[2].list[a];break}if(i.data.packagingMethod)for(a=0;a<s.paramsList[3].list.length;a++)if(s.paramsList[3].list[a].dictValue==i.data.packagingMethod){s.paramsList[3].value=s.paramsList[3].list[a].dictLabel,s.paramsList[3].select=s.paramsList[3].list[a];break}if(i.data.delivery)for(a=0;a<s.paramsList[4].list.length;a++)if(s.paramsList[4].list[a].dictValue==i.data.delivery){s.paramsList[4].value=s.paramsList[4].list[a].dictLabel,s.paramsList[4].select=s.paramsList[4].list[a];break}if(i.data.paymentTerms)for(a=0;a<s.paramsList[5].list.length;a++)if(s.paramsList[5].list[a].dictValue==i.data.paymentTerms){s.paramsList[5].value=s.paramsList[5].list[a].dictLabel,s.paramsList[5].select=s.paramsList[5].list[a];break}if(i.data.priceMode)for(a=0;a<s.paramsList[6].list.length;a++)if(s.paramsList[6].list[a].dictValue==i.data.priceMode){s.paramsList[6].value=i.data.priceMode,s.paramsList[6].select=s.paramsList[6].list[a];break}s.getProductList()}}))},lower:function(){this.productList.length==this.productTotal?this.is_show=!0:(this.is_show=!1,this.productPageNum++,this.getProductList())},getProductList:function(){var t=this,e={pageNum:this.productPageNum,pageSize:this.productPageSize,warehouseId:this.paramsList[0].select.warehouseId,carg:this.carg,productName:this.productVal,pinyin:this.pinyinVal};this.classifyIndex>0&&(e.classify=this.classifyList[this.classifyIndex].dictValue),(0,o.inventoryList)(e).then((function(e){200==e.code&&(t.productList=[].concat((0,a.default)(t.productList),(0,a.default)(e.data.items||[])),t.productTotal=e.data.total,t.chioceProduct())}))},chioceProduct:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.productList.forEach((function(s){1==e&&s.choice||t.$set(s,"choice",!1)}))},join:function(){if(0==Object.keys(this.choiceProduct).length)return t.showToast({title:"请选择产品",icon:"none",duration:1e3});for(var e=0;e<this.product.length;e++)if(this.product[e].productId==this.choiceProduct.productId)return t.showToast({title:"产品已存在",icon:"none",duration:1e3});this.$set(this.product[this.productIndex],"productName",this.choiceProduct.productName),this.$set(this.product[this.productIndex],"productId",this.choiceProduct.productId),this.$set(this.product[this.productIndex],"price",this.choiceProduct.price),this.$set(this.product[this.productIndex],"positionCode",this.choiceProduct.positionCode),this.$set(this.product[this.productIndex],"inventoryId",this.choiceProduct.inventoryId),this.$set(this.product[this.productIndex],"remark",this.choiceProduct.remark),this.$refs.product.close()},addProduct:function(){this.product.push({})},cleanUp:function(){this.product=[{productName:"",quantity:"",positionCode:"",price:"",remark:""}]},reduce:function(t){this.product.splice(t,1)},submit:function(e){if(!this.paramsList[0].value)return t.showToast({title:"业务门店不能为空",icon:"none",duration:1e3});if(!this.paramsList[1].value)return t.showToast({title:"往来客户不能为空",icon:"none",duration:1e3});if(!this.constructionWork)return t.showToast({title:"业务员不能为空",icon:"none",duration:1e3});if(!this.paramsList[3].value)return t.showToast({title:"包装方式不能为空",icon:"none",duration:1e3});if(!this.paramsList[5].value)return t.showToast({title:"结算方式不能为空",icon:"none",duration:1e3});if(!this.paramsList[6].value)return t.showToast({title:"价格方式不能为空",icon:"none",duration:1e3});for(var s=0;s<this.product.length;s++){if(!this.product[s].productName)return t.showToast({title:"请选择产品".concat(s+1),icon:"none",duration:1e3});if(!this.product[s].quantity)return t.showToast({title:"产品".concat(s+1,"的数量不能为空"),icon:"none",duration:1e3});if(this.product[s].quantity<=0||-1!=String(this.product[s].quantity).indexOf("."))return t.showToast({title:"产品".concat(s+1,"的数量不能为0、负数、小数"),icon:"none",duration:2e3})}t.showLoading({title:"加载中"});var i={outWarehouseId:this.outWarehouseId,storeName:this.paramsList[0].select.warehouseName,storeId:this.paramsList[0].select.warehouseId,customer:this.paramsList[1].select.name,customerId:this.paramsList[1].select.customerId,constructionWorkId:this.constructionWorkId,constructionWork:this.constructionWork,billType:this.paramsList[2].select.value,packagingMethod:this.paramsList[3].select.dictValue,delivery:this.paramsList[4].select.dictValue,paymentTerms:this.paramsList[5].select.dictValue,priceMode:this.paramsList[6].select.dictValue,state:0,detailList:this.product},a=Object.assign({},this.submitParams,i);this.outWarehouseId&&this.outWarehouseId.length>0&&this.is_conversion?(a.status=0==e?0:1,(0,o.editOutWarehouseSales)(a).then((function(s){t.hideLoading(),200==s.code&&(t.showToast({title:0==e?"暂存成功":"修改成功",icon:"none",duration:1500}),setTimeout((function(){t.navigateBack({delta:1})}),500))})).catch((function(e){t.showToast({title:e.message,icon:"none",duration:2500})}))):(a.status=0==e?0:1,a.type=3,(0,o.addOutWarehouseSales)(a).then((function(s){t.hideLoading(),200==s.code&&(t.showToast({title:0==e?"暂存成功":"销售单保存成功",icon:"none",duration:1500}),setTimeout((function(){t.navigateBack({delta:1})}),500))})).catch((function(e){t.showToast({title:e.message,icon:"none",duration:2500})})))},search:function(){this.productList=[],this.productPageNum=1,this.getProductList()},conversionSales:function(t,e){var s=this;this.is_conversion=e,(0,o.queryOutWarehouse)(t).then((function(t){s.outWarehouseId=t.data.outWarehouseId,s.getDetails(3)}))},getClassifyList:function(){var t=this;(0,o.dictData)("classification").then((function(e){e.data.map((function(e){t.classifySelectList.push(e.dictValue)})),t.classifyList=[].concat((0,a.default)(t.classifyList),(0,a.default)(e.data))}))},bindPickerChange:function(t){this.classifyIndex=t.detail.value},chioceView:function(){var e=this,s=t.getSystemInfoSync().platform;"android"==s?(plus.android.checkPermission("android.permission.CAMERA",(function(t){-1==t.checkResult&&(e.showMask=!0)}),(function(t){console.error("Error checking permission:",t.message)})),plus.android.requestPermissions(["android.permission.CAMERA"],(function(t){e.showMask=!1,t.granted.length>0&&e.scanCarg()}))):this.scanCarg()},scanCarg:function(){var e=this;t.scanCode({onlyFromCamera:!0,scanType:["barCode"],success:function(s){var i={carg:s.result,pageNum:1,pageSize:1,warehouseId:e.paramsList[0].select.warehouseId};(0,o.inventoryList)(i).then((function(s){if(200==s.code)if(s.data.items&&s.data.items.length>0){for(var i=0;i<e.product.length;i++)if(e.product[i].productId==s.data.items[0].productId)return t.showToast({title:"产品已存在",icon:"none",duration:1e3});var a=!0;for(i=0;i<e.product.length;i++)if(!e.product[i].productName){e.$set(e.product[i],"productName",s.data.items[0].productName),e.$set(e.product[i],"productId",s.data.items[0].productId),e.$set(e.product[i],"price",s.data.items[0].price),e.$set(e.product[i],"inventoryId",s.data.items[0].inventoryId),e.$set(e.product[i],"positionCode",s.data.items[0].positionCode),e.$set(e.product[i],"remark",s.data.items[0].remark),a=!1;break}if(a){var o={productName:s.data.items[0].productName,productId:s.data.items[0].productId,price:s.data.items[0].price,inventoryId:s.data.items[0].inventoryId,positionCode:s.data.items[0].positionCode,remark:s.data.items[0].remark};e.product.push(o)}t.showToast({title:"扫描添加成功",icon:"none",duration:2e3})}else t.showToast({title:"该产品不存在",icon:"none",duration:2e3});else t.showToast({title:s.message,icon:"none",duration:2e3})}))}})},openSalesman:function(){var t=this,e={pageNum:1,pageSize:1e3};(0,o.storeUserlist)(e).then((function(e){t.salesmanList=e.rows,t.$refs.salesman.open()}))},closesalesman:function(){this.$refs.salesman.close()},salesmanchoice:function(t){var e=this;this.salesmanList.forEach((function(s,i){s.userId==t.userId?(e.$set(e.salesmanList[i],"choice",!0),e.choiceSalesman=s):e.$set(e.salesmanList[i],"choice",!1)}))},submitSalesman:function(){this.constructionWork=this.choiceSalesman.userName,this.constructionWorkId=this.choiceSalesman.userId,this.$refs.salesman.close()}}};e.default=r}).call(this,s(2)["default"])},822:function(t,e,s){"use strict";s.r(e);var i=s(823),a=s.n(i);for(var o in i)["default"].indexOf(o)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(o);e["default"]=a.a},823:function(t,e,s){}},[[816,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/sales/addSalesInvoice.js.map