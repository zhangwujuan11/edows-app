(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/sales/editsalesReturn"],{856:function(e,t,s){"use strict";(function(e,t){var a=s(4);s(26);a(s(25));var r=a(s(857));e.__webpack_require_UNI_MP_PLUGIN__=s,t(r.default)}).call(this,s(1)["default"],s(2)["createPage"])},857:function(e,t,s){"use strict";s.r(t);var a=s(858),r=s(860);for(var i in r)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return r[e]}))}(i);s(862);var n,o=s(36),u=Object(o["default"])(r["default"],a["render"],a["staticRenderFns"],!1,null,"6a5efbe6",null,!1,a["components"],n);u.options.__file="pages/sales/editsalesReturn.vue",t["default"]=u.exports},858:function(e,t,s){"use strict";s.r(t);var a=s(859);s.d(t,"render",(function(){return a["render"]})),s.d(t,"staticRenderFns",(function(){return a["staticRenderFns"]})),s.d(t,"recyclableRender",(function(){return a["recyclableRender"]})),s.d(t,"components",(function(){return a["components"]}))},859:function(e,t,s){"use strict";var a;s.r(t),s.d(t,"render",(function(){return r})),s.d(t,"staticRenderFns",(function(){return n})),s.d(t,"recyclableRender",(function(){return i})),s.d(t,"components",(function(){return a}));try{a={uniForms:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uni-forms/components/uni-forms/uni-forms")]).then(s.bind(null,1116))},uniFormsItem:function(){return Promise.all([s.e("common/vendor"),s.e("uni_modules/uni-forms/components/uni-forms-item/uni-forms-item")]).then(s.bind(null,1129))},uniPopup:function(){return s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(s.bind(null,1075))}}}catch(o){if(-1===o.message.indexOf("Cannot find module")||-1===o.message.indexOf(".vue"))throw o;console.error(o.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var r=function(){var e=this,t=e.$createElement,s=(e._self._c,e.params.detailList.length),a=e.__map(e.params.detailList,(function(t,s){var a=e.__get_orig(t),r=e._f("decimalFormat")(e.num(s));return{$orig:a,f0:r}})),r=e.productList&&e.productList.length>0;e.$mp.data=Object.assign({},{$root:{g0:s,l0:a,g1:r}})},i=!1,n=[];r._withStripped=!0},860:function(e,t,s){"use strict";s.r(t);var a=s(861),r=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},861:function(e,t,s){"use strict";(function(e){var a=s(4);Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var r,i=a(s(53)),n=a(s(11)),o=a(s(55)),u=s(57),c=(s(473),s(25),function(){s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(function(){return resolve(s(1075))}.bind(null,s)).catch(s.oe)}),d={components:{uniPopup:c},data:function(){return{indicatorStyle:"height: 50px;",store:"",outWarehouseDelId:"",customer:"",storeName:"",delivery:"",paymentTerms:"",constructionWork:"",value:[0],selectList:[],selectList1:[],selectIndex:0,openIndex:null,product:[{},{}],productList:[],searchValue:"",params:{pageNum:1,pageSize:100,detailList:[{}]},index:"",params1:{pageNum:1,pageSize:20},item:{},title:"",aa:!1,Number:0,rules:{quantity:{rules:[{required:!0,errorMessage:"请输入正确数量"},{pattern:/^[1-9]\d*$/,errorMessage:"请输入大于零的整数"}]},price:{rules:[{required:!0,errorMessage:'请输入单价"'}]}},showMask:!1,salesmanList:[],choiceSalesman:{}}},onLoad:function(e){var t=this;return(0,o.default)(i.default.mark((function s(){var a;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,(0,u.detailoutWarehouseReturn)(e.id);case 2:a=s.sent,t.params=a.data,t.customer=t.params.customer,t.storeName=t.params.storeName,t.constructionWork=t.params.constructionWork,0==t.params.delivery?t.delivery="自提":1==t.params.delivery?t.delivery="送货":2==t.params.delivery?t.delivery="物流代收":t.delivery="物流不代收",1==t.params.paymentTerms?t.paymentTerms="现金付款":2==t.params.paymentTerms?t.paymentTerms="银行转账":3==t.params.paymentTerms?t.paymentTerms="微信":t.paymentTerms="挂账";case 9:case"end":return s.stop()}}),s)})))()},filters:{decimalFormat:function(e){return e.toFixed(2)}},computed:{num:function(e){return function(e){return void 0!=this.params.detailList[e].price&&void 0!=this.params.detailList[e].quantity?(this.params.detailList[e].num=this.params.detailList[e].quantity*this.params.detailList[e].price,this.params.detailList[e].totalPrice=this.params.detailList[e].num,this.params.detailList[e].num):this.params.detailList[e].num=0}}},onBackPress:function(e){if("navigateBack"==e.from){var t=getCurrentPages(),s=t[t.length-2];s=s.$vm,s&&s.getList&&s.getList(1,s.list.length+1)}},methods:(r={open:function(t){var s=this;return(0,o.default)(i.default.mark((function a(){var r,n,o,c;return i.default.wrap((function(a){while(1)switch(a.prev=a.next){case 0:s.selectIndex=0,s.selectList=[],s.selectList1=[],a.t0=t,a.next=0===a.t0?6:1===a.t0?12:2===a.t0?18:3===a.t0?24:30;break;case 6:return s.title="请选择往来客户",a.next=9,(0,u.getcustomer)(s.params1);case 9:return r=a.sent,r.data.items?r.data.items.forEach((function(e){s.selectList.push(e.name),s.selectList1.push(e.customerId)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",30);case 12:return s.title="请选择业务门店",a.next=15,(0,u.getwarehouse)(s.params);case 15:return n=a.sent,n.data.items?n.data.items.forEach((function(e){s.selectList.push(e.warehouseName),s.selectList1.push(e.warehouseId)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",30);case 18:return s.title="请选择配送方式",a.next=21,(0,u.getdelivery)(s.params);case 21:return o=a.sent,o.data?o.data.forEach((function(e){s.selectList.push(e.dictLabel)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",30);case 24:return s.title="请选择结算方式",a.next=27,(0,u.getpaymentTerms)(s.params);case 27:return c=a.sent,c.data?c.data.forEach((function(e){s.selectList.push(e.dictLabel)})):e.showToast({title:"没有数据",icon:"none",duration:1e3}),a.abrupt("break",30);case 30:s.$refs.popup.open(),s.openIndex=t;case 32:case"end":return a.stop()}}),a)})))()},clear:function(){this.params.detailList=[{quantity:"",price:"",remark:""}]},scrolltolowerFun:function(){var e=this;return(0,o.default)(i.default.mark((function t(){var s;return i.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.params1.pageNum=e.params1.pageNum+1,e.params1.customerId=e.customerId,t.next=4,(0,u.getBound)(e.params1);case 4:if(s=t.sent,0==s.data.items.length){t.next=9;break}s.data.items.forEach((function(t){e.productList.push(t)})),t.next=11;break;case 9:return e.aa=!0,t.abrupt("return");case 11:case"end":return t.stop()}}),t)})))()},add:function(){this.params.detailList.push({}),this.Number++},del:function(e){if(this.params.detailList.length>1){var t=this.params.detailList.filter((function(t,s){return s!==e}));this.params.detailList=t}this.Number>0&&this.Number--},cancel:function(){this.$refs.popup.close()},success:function(){switch(this.openIndex){case 0:this.customer=this.selectList[this.selectIndex],this.params.customer!=this.customer&&this.clear(),this.params.customer=this.customer,this.params.customerId=this.selectList1[this.selectIndex];break;case 1:this.storeName=this.selectList[this.selectIndex],this.params.storeName!=this.storeName&&this.clear(),this.params.storeName=this.storeName,this.params.storeId=this.selectList1[this.selectIndex],this.clear();break;case 2:this.delivery=this.selectList[this.selectIndex],this.params.delivery=this.selectList[this.selectIndex],"自提"==this.params.delivery?this.params.delivery=0:"送货"==this.params.delivery?this.params.delivery=1:"物流代收"==this.params.delivery?this.params.delivery=2:this.params.delivery=3;break;case 3:this.paymentTerms=this.selectList[this.selectIndex],this.params.paymentTerms=this.selectList[this.selectIndex],"现金付款"==this.params.paymentTerms?this.params.paymentTerms=1:"银行转账"==this.params.paymentTerms?this.params.paymentTerms=2:"微信"==this.params.paymentTerms?this.params.paymentTerms=3:this.params.paymentTerms=0;break}this.$refs.popup.close()},Return:function(){var t=this;return(0,o.default)(i.default.mark((function s(){var a;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.params.status=1,void 0!=t.params.constructionWork){s.next=5;break}return s.abrupt("return",e.showToast({title:"请选择业务员",icon:"none",duration:1e3}));case 5:if(void 0!=t.params.delivery){s.next=9;break}return s.abrupt("return",e.showToast({title:"请选择配送方式",icon:"none",duration:1e3}));case 9:if(void 0!=t.params.paymentTerms){s.next=13;break}return s.abrupt("return",e.showToast({title:"请选择结算方式",icon:"none",duration:1e3}));case 13:for(a=0;a<=t.Number;a++)t.$refs.form[a].validate().then(function(){var s=(0,o.default)(i.default.mark((function s(a){var r;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,(0,u.editoutWarehouseReturn)(t.params);case 2:r=s.sent,200==r.code&&(e.showToast({title:"修改成功",icon:"none",duration:1e3}),setTimeout((function(){e.navigateBack({data:1})}),1e3));case 4:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}());case 14:case"end":return s.stop()}}),s)})))()},Return1:function(){var t=this;return(0,o.default)(i.default.mark((function s(){var a;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(t.params.status=0,void 0!=t.params.constructionWork){s.next=5;break}return s.abrupt("return",e.showToast({title:"请选择业务员",icon:"none",duration:1e3}));case 5:if(void 0!=t.params.delivery){s.next=9;break}return s.abrupt("return",e.showToast({title:"请选择配送方式",icon:"none",duration:1e3}));case 9:if(void 0!=t.params.paymentTerms){s.next=13;break}return s.abrupt("return",e.showToast({title:"请选择结算方式",icon:"none",duration:1e3}));case 13:for(a=0;a<=t.Number;a++)t.$refs.form[a].validate().then(function(){var s=(0,o.default)(i.default.mark((function s(a){var r;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,(0,u.editoutWarehouseReturn)(t.params);case 2:r=s.sent,200==r.code&&(e.showToast({title:"暂存成功",icon:"none",duration:1e3}),setTimeout((function(){e.navigateBack({data:1})}),1e3));case 4:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}());case 14:case"end":return s.stop()}}),s)})))()},bindChange:function(e){this.selectIndex=e.detail.value[0]},openProduct:function(e){var t=this;return(0,o.default)(i.default.mark((function s(){var a;return i.default.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.outWarehouseDelId="",t.index=e,t.params.pageNum=1,t.params.pageSize=20,s.next=6,(0,u.getBound)(t.params);case 6:a=s.sent,null!=a.data.items&&(t.productList=a.data.items),t.$refs.product.open();case 9:case"end":return s.stop()}}),s)})))()},closeProduct:function(){this.$refs.product.close()},choice:function(e){this.outWarehouseDelId=e.outWarehouseDelId,this.item=e},join:function(){if(""==this.outWarehouseDelId)return e.showToast({title:"请选择产品",icon:"none",duration:1e3});for(var t=0;t<this.params.detailList.length;t++)if(this.params.detailList[t].outWarehouseDelId==this.item.outWarehouseDelId)return e.showToast({title:"不能添加相同的产品",icon:"none",duration:1e3});this.$set(this.params.detailList[this.index],"inventoryId",this.item.inventoryId),this.$set(this.params.detailList[this.index],"outWarehouseDelId",this.item.outWarehouseDelId),this.$set(this.params.detailList[this.index],"positionCode",this.item.positionCode),this.$set(this.params.detailList[this.index],"productName",this.item.productName),this.$set(this.params.detailList[this.index],"productId",this.item.productId),this.$set(this.params.detailList[this.index],"usableQuantity",this.item.usableQuantity),this.$set(this.params.detailList[this.index],"price",this.item.price),this.$refs.product.close()},chioceView:function(){var t=this,s=e.getSystemInfoSync().platform;"android"==s?(plus.android.checkPermission("android.permission.CAMERA",(function(e){-1==e.checkResult&&(t.showMask=!0)}),(function(e){console.error("Error checking permission:",e.message)})),plus.android.requestPermissions(["android.permission.CAMERA"],(function(e){t.showMask=!1,e.granted.length>0&&t.scanCarg()}))):this.scanCarg()}},(0,n.default)(r,"chioceView",(function(){var t=this,s=e.getSystemInfoSync().platform;"android"==s?(plus.android.checkPermission("android.permission.CAMERA",(function(e){-1==e.checkResult&&(t.showMask=!0)}),(function(e){console.error("Error checking permission:",e.message)})),plus.android.requestPermissions(["android.permission.CAMERA"],(function(e){t.showMask=!1,e.granted.length>0&&t.scanCarg()}))):this.scanCarg()})),(0,n.default)(r,"scanCarg",(function(){var t=this;e.scanCode({onlyFromCamera:!0,scanType:["barCode"],success:function(s){var a={carg:s.result,pageNum:1,pageSize:1,customerId:t.params.customerId,storeId:t.params.storeId};(0,u.getBound)(a).then((function(s){if(200==s.code)if(s.data.items&&s.data.items.length>0){for(var a=0;a<t.params.detailList.length;a++)if(t.params.detailList[a].productId==s.data.items[0].productId)return e.showToast({title:"不能重复退货",icon:"none",duration:1e3});var r=!0;for(a=0;a<t.params.detailList.length;a++)if(!t.params.detailList[a].productName){t.$set(t.params.detailList[a],"productName",s.data.items[0].productName),t.$set(t.params.detailList[a],"productId",s.data.items[0].productId),t.$set(t.params.detailList[a],"price",s.data.items[0].price),t.$set(t.params.detailList[a],"inventoryId",s.data.items[0].inventoryId),t.$set(t.params.detailList[a],"positionCode",s.data.items[0].positionCode),t.$set(t.params.detailList[a],"usableQuantity",s.data.items[0].usableQuantity),t.$set(t.params.detailList[a],"outWarehouseDelId",s.data.items[0].outWarehouseDelId),r=!1;break}if(r){var i={productName:s.data.items[0].productName,productId:s.data.items[0].productId,price:s.data.items[0].price,inventoryId:s.data.items[0].inventoryId,positionCode:s.data.items[0].positionCode,usableQuantity:s.data.items[0].usableQuantity,outWarehouseDelId:s.data.items[0].outWarehouseDelId};t.params.detailList.push(i)}e.showToast({title:"扫描添加成功",icon:"none",duration:2e3})}else e.showToast({title:"该产品不存在",icon:"none",duration:2e3});else e.showToast({title:s.message,icon:"none",duration:2e3})}))}})})),(0,n.default)(r,"openSalesman",(function(){var e=this,t={pageNum:1,pageSize:1e3};(0,u.getwen)(t).then((function(t){e.salesmanList=t.rows,e.$refs.salesman.open()}))})),(0,n.default)(r,"closesalesman",(function(){this.$refs.salesman.close()})),(0,n.default)(r,"salesmanchoice",(function(e){var t=this;this.salesmanList.forEach((function(s,a){s.userId==e.userId?(t.$set(t.salesmanList[a],"choice",!0),t.choiceSalesman=s):t.$set(t.salesmanList[a],"choice",!1)}))})),(0,n.default)(r,"submitSalesman",(function(){this.constructionWork=this.choiceSalesman.userName,this.params.constructionWork=this.choiceSalesman.userName,this.params.constructionWorkId=this.choiceSalesman.userId,this.$refs.salesman.close()})),r)};t.default=d}).call(this,s(2)["default"])},862:function(e,t,s){"use strict";s.r(t);var a=s(863),r=s.n(a);for(var i in a)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return a[e]}))}(i);t["default"]=r.a},863:function(e,t,s){}},[[856,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/sales/editsalesReturn.js.map