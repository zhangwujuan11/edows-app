(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/warehouse/addReturn"],{704:function(t,e,s){"use strict";(function(t,e){var i=s(4);s(26);i(s(25));var a=i(s(705));t.__webpack_require_UNI_MP_PLUGIN__=s,e(a.default)}).call(this,s(1)["default"],s(2)["createPage"])},705:function(t,e,s){"use strict";s.r(e);var i=s(706),a=s(708);for(var n in a)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return a[t]}))}(n);s(710);var o,r=s(36),c=Object(r["default"])(a["default"],i["render"],i["staticRenderFns"],!1,null,"4325a37c",null,!1,i["components"],o);c.options.__file="pages/warehouse/addReturn.vue",e["default"]=c.exports},706:function(t,e,s){"use strict";s.r(e);var i=s(707);s.d(e,"render",(function(){return i["render"]})),s.d(e,"staticRenderFns",(function(){return i["staticRenderFns"]})),s.d(e,"recyclableRender",(function(){return i["recyclableRender"]})),s.d(e,"components",(function(){return i["components"]}))},707:function(t,e,s){"use strict";var i;s.r(e),s.d(e,"render",(function(){return a})),s.d(e,"staticRenderFns",(function(){return o})),s.d(e,"recyclableRender",(function(){return n})),s.d(e,"components",(function(){return i}));try{i={uniPopup:function(){return s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(s.bind(null,1075))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var a=function(){var t=this,e=t.$createElement,s=(t._self._c,t.product.length),i=t.productList&&t.productList.length>0;t.$mp.data=Object.assign({},{$root:{g0:s,g1:i}})},n=!1,o=[];a._withStripped=!0},708:function(t,e,s){"use strict";s.r(e);var i=s(709),a=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e["default"]=a.a},709:function(t,e,s){"use strict";(function(t){var i=s(4);Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var a=i(s(18)),n=s(58),o=function(){s.e("uni_modules/uni-popup/components/uni-popup/uni-popup").then(function(){return resolve(s(1075))}.bind(null,s)).catch(s.oe)},r={components:{uniPopup:o},data:function(){return{indicatorStyle:"height: 50px;",store:"",supplier:"",selectList:[],currIndex:0,product:[{}],productList:[],carg:"",productVal:"",pinyinVal:"",classifyIndex:0,classifySelectList:["全部"],classifyList:["全部"],inWarehouseId:"",selectTitle:"",paramsList:[{name:"门店",value:"",selected:[0],list:[],selectIndex:0,selectList:{}},{name:"供应商",value:"",selected:[0],list:[],selectIndex:0,selectList:{}},{name:"结算方式",value:"",selected:[0],list:[],selectIndex:0}],productPageNum:1,productPageSize:10,productTotal:0,operate:{},choiceProduct:{},productIndex:0,submitParams:{},is_show:!1,showMask:!1}},onBackPress:function(t){if("navigateBack"==t.from){var e=getCurrentPages(),s=e[e.length-2];s=s.$vm,s&&s.getList&&s.getList(1,s.list.length+1)}},onLoad:function(e){var s=this;e.inWarehouseId&&(this.inWarehouseId=e.inWarehouseId,t.setNavigationBarTitle({title:"修改入库单"})),Promise.all([this.getWarehouseList(),this.getSupplierList(),this.getPaymentTerms()]).then((function(){e.inWarehouseId?s.getinWarehouseDetails().then((function(){s.getProductList()})):(s.paramsList[0].value=s.paramsList[0].list[s.paramsList[0].selectIndex].warehouseName,s.paramsList[0].selectList=s.paramsList[0].list[s.paramsList[0].selectIndex],s.productList=[],s.productPageNum=1,s.productPageSize=10,s.getProductList())})),this.getClassifyList()},methods:{open:function(t){switch(this.$refs.popup.open(),this.currIndex=t,t){case 0:this.selectTitle="门店";break;case 1:this.selectTitle="供应商";break;case 2:this.selectTitle="结算方式";break}},cancel:function(){this.$refs.popup.close()},success:function(){switch(this.paramsList[this.currIndex].selected=[this.paramsList[this.currIndex].selectIndex],this.currIndex){case 0:this.paramsList[0].value=this.paramsList[0].list[this.paramsList[0].selectIndex].warehouseName,this.paramsList[0].selectList=this.paramsList[0].list[this.paramsList[0].selectIndex],this.productList=[],this.productPageNum=1,this.productPageSize=10,this.getProductList(),this.cleanUp();break;case 1:this.paramsList[1].value=this.paramsList[1].list[this.paramsList[1].selectIndex].supplierName,this.paramsList[1].selectList=this.paramsList[1].list[this.paramsList[1].selectIndex],this.productList=[],this.productPageNum=1,this.productPageSize=10,this.getProductList(),this.cleanUp();break;case 2:this.paramsList[2].value=this.paramsList[2].list[this.paramsList[2].selectIndex].dictLabel;break}this.$refs.popup.close()},bindChange:function(t){this.paramsList[this.currIndex].selectIndex=t.detail.value[0]},openProduct:function(t,e){this.operate=t,this.productIndex=e,this.$refs.product.open(),this.chioceProduct(0),this.choiceProduct={}},closeProduct:function(){this.$refs.product.close()},choice:function(t){var e=this;this.productList.forEach((function(s,i){s.productId==t.productId&&t.positionCode==s.positionCode?(e.$set(e.productList[i],"choice",!0),e.choiceProduct=s):e.$set(e.productList[i],"choice",!1)}))},getWarehouseList:function(){var t=this;return new Promise((function(e,s){(0,n.warehouseList)().then((function(s){200==s.code&&(t.paramsList[0].list=s.data.items,e(s))}))}))},getSupplierList:function(){var t=this;return new Promise((function(e,s){(0,n.supplierList)({status:0}).then((function(s){200==s.code&&(t.paramsList[1].list=s.data.items,e(s))}))}))},getPaymentTerms:function(){var t=this;return new Promise((function(e,s){(0,n.paymentTerms)().then((function(s){200==s.code&&(t.paramsList[2].list=s.data,e(s))}))}))},getinWarehouseDetails:function(){var e=this;return new Promise((function(s,i){t.showLoading({title:"加载中"}),(0,n.inWarehouseDetails)(e.inWarehouseId).then((function(i){if(t.hideLoading(),200==i.code){if(e.product=i.data.storeInWarehouseDetailBoList,e.submitParams=i.data,i.data.warehouseName)for(var a=0;a<e.paramsList[0].list.length;a++)if(e.paramsList[0].list[a].warehouseId==i.data.warehouseId){e.paramsList[0].value=i.data.warehouseName,e.paramsList[0].selected=[a],e.paramsList[0].selectIndex=a,e.paramsList[0].selectList=e.paramsList[0].list[a];break}if(i.data.vendorName)for(a=0;a<e.paramsList[1].list.length;a++)if(e.paramsList[1].list[a].supplierCode==i.data.vendorCode){e.paramsList[1].value=i.data.vendorName,e.paramsList[1].selected=[a],e.paramsList[1].selectIndex=a,e.paramsList[1].selectList=e.paramsList[1].list[a];break}if(i.data.paymentTerms)for(a=0;a<e.paramsList[2].list.length;a++)if(e.paramsList[2].list[a].dictValue==i.data.paymentTerms){e.paramsList[2].value=e.paramsList[2].list[a].dictLabel,e.paramsList[2].selected=[a],e.paramsList[2].selectIndex=a;break}s(i)}}))}))},getProductList:function(){var e=this;t.showLoading({title:"加载中"});var s={pageNum:this.productPageNum,pageSize:this.productPageSize,warehouseId:this.paramsList[0].selectList.warehouseId,vendorId:this.paramsList[1].selectList.supplierId,carg:this.carg,productName:this.productVal,pinyin:this.pinyinVal};this.classifyIndex>0&&(s.classify=this.classifyList[this.classifyIndex].dictValue),(0,n.inventoryList)(s).then((function(s){t.hideLoading(),200==s.code&&(e.productList=[].concat((0,a.default)(e.productList),(0,a.default)(s.data.items||[])),e.productTotal=s.data.total,e.chioceProduct())})).catch((function(e){t.hideLoading()}))},lower:function(){this.productList.length==this.productTotal?this.is_show=!0:(this.is_show=!1,this.productPageNum++,this.getProductList())},chioceProduct:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1;this.productList.forEach((function(s){1==e&&s.choice||t.$set(s,"choice",!1)}))},join:function(){if(0==Object.keys(this.choiceProduct).length)return t.showToast({title:"请选择产品",icon:"none",duration:1e3});for(var e=0;e<this.product.length;e++)if(this.product[e].productId==this.choiceProduct.productId)return t.showToast({title:"不能重复退货",icon:"none",duration:1e3});this.$set(this.product[this.productIndex],"productName",this.choiceProduct.productName),this.$set(this.product[this.productIndex],"productId",this.choiceProduct.productId),this.$set(this.product[this.productIndex],"price",this.choiceProduct.price),this.$set(this.product[this.productIndex],"inventoryId",this.choiceProduct.inventoryId),this.$set(this.product[this.productIndex],"receivalQuantity",null),this.$refs.product.close()},addProduct:function(){this.product.push({})},search:function(){this.productList=[],this.productPageNum=1,this.getProductList()},submit:function(e){for(var s=0;s<this.paramsList.length;s++)if(!this.paramsList[s].value)return t.showToast({title:"".concat(this.paramsList[s].name,"不能为空"),icon:"none",duration:1e3});for(s=0;s<this.product.length;s++){if(!this.product[s].productName)return t.showToast({title:"请选择产品".concat(s+1),icon:"none",duration:1e3});if(!this.product[s].receivalQuantity)return t.showToast({title:"产品".concat(s+1,"的数量不能为空"),icon:"none",duration:1e3});if(this.product[s].receivalQuantity<=0||-1!=String(this.product[s].receivalQuantity).indexOf("."))return t.showToast({title:"产品".concat(s+1,"的数量不能为0、负数、小数"),icon:"none",duration:2e3});if(!this.product[s].price)return t.showToast({title:"产品".concat(s+1,"的单价不能为空"),icon:"none",duration:1e3})}t.showLoading({title:"加载中"});var i={inWarehouseId:this.inWarehouseId,warehouseId:this.paramsList[0].list[this.paramsList[0].selected].warehouseId,vendorId:this.paramsList[1].list[this.paramsList[1].selected].supplierId,paymentTerms:this.paramsList[2].list[this.paramsList[2].selected].dictValue,storeInWarehouseDetailBoList:this.product},a=Object.assign({},this.submitParams,i);this.inWarehouseId&&this.inWarehouseId.length>0?(a.status=0==e?0:1,(0,n.editStorePurchaseReturn)(a).then((function(s){t.hideLoading(),200==s.code&&(t.showToast({title:0==e?"暂存成功":"修改成功",icon:"none",duration:1e3}),setTimeout((function(){t.navigateBack({delta:1})}),500))})).catch((function(e){t.showToast({title:e.message,icon:"none",duration:2500})}))):(a.status=0==e?0:1,(0,n.addStorePurchaseReturn)(a).then((function(s){t.hideLoading(),200==s.code&&(t.showToast({title:0==e?"暂存成功":"退货单保存成功",icon:"none",duration:1e3}),setTimeout((function(){t.navigateBack({delta:1})}),500))})).catch((function(e){t.showToast({title:e.message,icon:"none",duration:2500})})))},reduce:function(t){this.product.splice(t,1)},closeMask:function(t){0==t.show&&(this.paramsList[this.currIndex].selectIndex=[this.paramsList[this.currIndex].selected[0]])},cleanUp:function(){this.product=[{productName:"",receivalQuantity:"",price:"",remark:""}]},getClassifyList:function(){var t=this;(0,n.dictData)("classification").then((function(e){e.data.map((function(e){t.classifySelectList.push(e.dictValue)})),t.classifyList=[].concat((0,a.default)(t.classifyList),(0,a.default)(e.data))}))},bindPickerChange:function(t){this.classifyIndex=t.detail.value},chioceView:function(){var e=this,s=t.getSystemInfoSync().platform;"android"==s?(plus.android.checkPermission("android.permission.CAMERA",(function(t){-1==t.checkResult&&(e.showMask=!0)}),(function(t){console.error("Error checking permission:",t.message)})),plus.android.requestPermissions(["android.permission.CAMERA"],(function(t){e.showMask=!1,t.granted.length>0&&e.scanCarg()}))):this.scanCarg()},scanCarg:function(){var e=this;t.scanCode({onlyFromCamera:!0,scanType:["barCode"],success:function(s){var i={carg:s.result,pageNum:1,pageSize:1,warehouseId:e.paramsList[0].selectList.warehouseId,vendorId:e.paramsList[1].selectList.supplierId};(0,n.inventoryList)(i).then((function(s){if(200==s.code)if(s.data.items&&s.data.items.length>0){for(var i=0;i<e.product.length;i++)if(e.product[i].productId==s.data.items[0].productId)return t.showToast({title:"不能重复退货",icon:"none",duration:1e3});var a=!0;for(i=0;i<e.product.length;i++)if(!e.product[i].productName){e.$set(e.product[i],"productName",s.data.items[0].productName),e.$set(e.product[i],"productId",s.data.items[0].productId),e.$set(e.product[i],"price",s.data.items[0].price),e.$set(e.product[i],"inventoryId",s.data.items[0].inventoryId),e.$set(e.product[i],"receivalQuantity",null),a=!1;break}if(a){var n={productName:s.data.items[0].productName,productId:s.data.items[0].productId,price:s.data.items[0].price,inventoryId:s.data.items[0].inventoryId,receivalQuantity:null};e.product.push(n)}t.showToast({title:"扫描添加成功",icon:"none",duration:2e3})}else t.showToast({title:"该产品不存在",icon:"none",duration:2e3});else t.showToast({title:s.message,icon:"none",duration:2e3})}))}})}}};e.default=r}).call(this,s(2)["default"])},710:function(t,e,s){"use strict";s.r(e);var i=s(711),a=s.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){s.d(e,t,(function(){return i[t]}))}(n);e["default"]=a.a},711:function(t,e,s){}},[[704,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/warehouse/addReturn.js.map